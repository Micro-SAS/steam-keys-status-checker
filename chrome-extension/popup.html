<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam Keys Checker</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="extension-container">
        <!-- Header -->
        <header class="extension-header">
            <div class="header-content">
                <div class="header-text">
                    <h1>Steam Keys Checker</h1>
                    <p class="version">v1.1.0</p>
                </div>
                <a href="https://www.hushcrasher.com" target="_blank" class="header-logo-link">
                    <img src="icons/hush-crasher-logo.svg" alt="HUSH CRASHER" class="header-logo">
                </a>
            </div>
        </header>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            <div class="status-indicator" id="statusIndicator"></div>
            <span class="status-text" id="statusText">Ready</span>
        </div>

        <!-- Main Content -->
        <main class="extension-main">
            <!-- Step 1: Steamworks Connection -->
            <section class="step-section" id="stepConnection">
                <div class="step-header">
                    <h2>üîó 1. Steamworks Connection</h2>
                </div>
                
                <div class="connection-status" id="connectionStatus">
                    <div class="connection-check">
                        <div class="loading-spinner" id="connectionSpinner"></div>
                        <p id="connectionText">Checking connection...</p>
                    </div>
                </div>
                
                <div class="connection-success" id="connectionSuccess" style="display: none;">
                    <div class="success-indicator">
                        <span class="success-icon">‚úÖ</span>
                        <p>Connected to Steamworks</p>
                    </div>
                </div>
                
                <div class="connection-instructions" id="connectionInstructions" style="display: none;">
                    <div class="instruction-box">
                        <h3>üöÄ Connection required:</h3>
                        <p>You must be logged into your Steamworks Partner space to use this extension.</p>
                        <div class="connection-buttons">
                            <button class="btn btn-primary btn-large" id="connectSteamworksBtn">
                                üåê Connect to my Steamworks space
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 2: File Upload -->
            <section class="step-section" id="stepUpload" style="display: none;">
                <div class="step-header">
                    <h2>üìÅ 2. Import your CSV</h2>
                </div>
                
                <div class="file-upload-area">
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                    <div class="file-drop-zone" id="fileDropZone">
                        <div class="drop-zone-content">
                            <div class="drop-zone-icon">üìÑ</div>
                            <p class="drop-zone-text">Drag your CSV file here</p>
                            <p class="drop-zone-subtext">or</p>
                            <button class="btn btn-primary" id="selectFileBtn">
                                Choose a file
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-info" id="fileInfo" style="display: none;">
                        <div class="file-details">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-stats" id="fileStats"></span>
                        </div>
                        <button class="btn btn-small btn-secondary" id="changeFileBtn">
                            Change
                        </button>
                    </div>
                </div>
            </section>

            <!-- Step 3: Column Configuration -->
            <section class="step-section" id="stepConfig" style="display: none;">
                <div class="step-header">
                    <h2>‚öôÔ∏è 3. Column Configuration</h2>
                </div>
                
                <div class="config-form">
                    <div class="form-group">
                        <label for="key1Column">Which column contains the keys?</label>
                        <select id="key1Column" class="form-select">
                            <option value="">Select...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hasKey2Checkbox">
                            <span class="checkmark"></span>
                            Are Steam keys also stored in a second column?
                        </label>
                    </div>
                    
                    <div class="form-group" id="key2ColumnGroup" style="display: none;">
                        <label for="key2Column">Select the name of the other column where Steam keys are located:</label>
                        <select id="key2Column" class="form-select">
                            <option value="">Select...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Check verification on:</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="checkScope" id="checkAllKeys" value="all" checked>
                                <span class="radio-custom"></span>
                                All keys in the file
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="checkScope" id="checkFilteredKeys" value="filtered">
                                <span class="radio-custom"></span>
                                On a filtered portion
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="filterGroup" style="display: none;">
                        <div class="filter-container">
                            <span class="filter-text">If</span>
                            <select id="filterColumn" class="form-select">
                                <option value="">Select...</option>
                            </select>
                            <span class="filter-text">=</span>
                            <select id="filterValue" class="form-select">
                                <option value="true">True</option>
                                <option value="yes">Yes/yes</option>
                                <option value="x">x/X</option>
                            </select>
                        </div>
                    </div>
                    

                </div>
            </section>

            <!-- Step 4: Processing -->
            <section class="step-section" id="stepProcessing" style="display: none;">
                <div class="processing-info">
                    <div class="warning-message">
                        <div class="warning-icon">‚ö†Ô∏è</div>
                        <p>Stay on the Steamworks page during verification. Sorry for the inconvenience.</p>
                    </div>
                    <div class="processing-controls">
                        <button class="btn btn-start btn-large" id="startCheckingBtn">
                            üîç Start verification
                        </button>
                        <button class="btn btn-danger" id="stopCheckingBtn" style="display: none;">
                            ‚èπÔ∏è Stop
                        </button>
                    </div>
                    
                    <div class="progress-section" id="progressSection" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-info">
                            <span id="progressText">0 / 0 keys verified</span>
                            <span id="currentKeyText"></span>
                        </div>
                        
                        <div class="live-results" id="liveResults">
                            <div class="result-counters">
                                <div class="counter activated">
                                    <span class="counter-label">Activated</span>
                                    <span class="counter-value" id="activatedCount">0</span>
                                </div>
                                <div class="counter not-activated">
                                    <span class="counter-label">Not activated</span>
                                    <span class="counter-value" id="notActivatedCount">0</span>
                                </div>
                                <div class="counter error">
                                    <span class="counter-label">Errors</span>
                                    <span class="counter-value" id="errorCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 5: Results -->
            <section class="step-section" id="stepResults" style="display: none;">
                <div class="step-header results-header">
                    <h2 style="text-align:center;">üìä Results</h2>
                </div>
                
                <div class="results-summary" id="resultsSummary"></div>
                
                <div class="results-actions">
                    <button class="btn btn-start btn-large" id="downloadResultsBtn">
                        üíæ Download CSV
                    </button>
                </div>
                
                <div class="results-preview" id="resultsPreview">
                    <h3>Results preview:</h3>
                    <div class="results-table-container">
                        <table class="results-table" id="resultsTable">
                            <thead>
                                <tr>
                                    <th>Key</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="new-check-action">
                    <button class="btn btn-secondary btn-large" id="newCheckBtn">
                        üîÑ New verification
                    </button>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="extension-footer">
            <div class="footer-links">
                <a href="https://github.com/Micro-SAS/steam-keys-status-checker" target="_blank" class="footer-link">
                    üìö GitHub
                </a>
                <a href="#" id="aboutBtn" class="footer-link">
                    ‚ÑπÔ∏è About
                </a>
            </div>
        </footer>
    </div>

    <!-- Error Modal -->
    <div class="modal" id="errorModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ùå Error</h3>
                <button class="modal-close" id="errorModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p id="errorMessage"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="errorModalOk">OK</button>
            </div>
        </div>
    </div>

    <!-- Steamworks Connection Info Modal -->
    <div class="modal" id="steamworksInfoModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ü•∫ Come back!</h3>
                <button class="modal-close" id="steamworksInfoModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="info-content">
                    <p>After logging into your Steamworks account:</p>
                    <ol>
                        <li>Make sure you're on the key verification page (https://partner.steamgames.com/querycdkey/)</li>
                        <li><strong>Come back to this extension popup</strong></li>
                        <li>Upload your CSV of Steam keys to check their status</li>
                    </ol>

                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="steamworksInfoCancel">Cancel</button>
                <button class="btn btn-primary" id="steamworksInfoContinue">Continue to Steamworks</button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="aboutModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ÑπÔ∏è About Steam Keys Checker</h3>
                <button class="modal-close" id="aboutModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="about-content">
                    <p><strong>Find out who activated which Steam key!</strong></p>
                    <p>This Chrome extension automates the verification of your Steam keys' status. Track the performance of your key distributions to content creators. 
                        <br>Save hours of manual checking.</p>
                    
                    <div class="features-list">
                        <h4>Key Benefits:</h4>
                        <ul>
                            <li>‚úÖ <strong>Bulk verification</strong> - Check hundreds of keys at once</li>
                            <li>üìä <strong>CSV integration</strong> - Import/export your key databases</li>
                            <li>üîç <strong>Smart filtering</strong> - Target specific key batches</li>
                        </ul>
                    </div>
                    
                    <div class="lexicon-section">
                        <h4>üìö Status Lexicon:</h4>
                        <div class="status-definitions">
                            <div class="status-item">
                                <span class="status-badge activated">Activated</span>
                                <p>The Steam key has been activated by a user.</p>
                            </div>
                            <div class="status-item">
                                <span class="status-badge not-activated">Not activated</span>
                                <p>The Steam key is valid but hasn't been redeemed yet. Still available for distribution.</p>
                            </div>
                            <div class="status-item">
                                <span class="status-badge invalid">Invalid format</span>
                                <p>The key format is incorrect or doesn't match Steam's expected pattern.</p>
                            </div>
                            <div class="status-item">
                                <span class="status-badge ownership">Ownership issue</span>
                                <p>The key exists but you don't have access to it. You have to be the one who created it to check its status.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="about-footer">
                        <p>Version 1.1.0 | <a href="https://www.hushcrasher.com" target="_blank">HUSH CRASHER</a></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="aboutModalOk">Got it!</button>
            </div>
        </div>
    </div>

    <script src="popup.js"></script>
</body>
</html> 